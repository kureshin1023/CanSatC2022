<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>flask streaming</title>
        <script>
            window.addEventListener("load",function(){
                window.addEventListener('keydown', keyboardDown);
                window.addEventListener("keyup", keyboardUp);
                document.getElementById("jettison").addEventListener('mousedown', down);
            });
            function down(event) {
                var element = document.getElementById("jettison");
                var formData = new FormData();
                formData.append("click", event.button)
                fetch("/jettison", {
                    method: 'POST',
                    body: formData
                });
                event.preventDefault();
            };
            function keyboardDown(event) {
            event.preventDefault();
            var element = document.getElementById("screen");
            var formData = new FormData();
            formData.append("keyDown",event.key)
            fetch("/keyboard_down", {
                method: "POST",
                body: formData
                });
            };
            function keyboardUp(event) {
            event.preventDefault();
            var element = document.getElementById("screen");
            var formData = new FormData();
            formData.append("keyUp",event.key)
            fetch("/keyboard_up", {
                method: "POST",
                body: formData
                });
            };
            window.onload = function(){
                var x_deg = document.getElementById("x_deg");

                setInterval(() => {
                    fetch("{{ url_for('x_deg_feed') }}")
                    .then(response => {
                            response.text().then(x => {x_deg.innerText = x})
                        });
                    }, 1000);

                var y_deg = document.getElementById("y_deg");

                setInterval(() => {
                    fetch("{{ url_for('y_deg_feed') }}")
                    .then(response => {
                            response.text().then(y => {y_deg.innerText = y})
                        });
                    }, 1000);

                var GPS = document.getElementById("gps");

                setInterval(() => {
                    fetch("{{ url_for('gps_feed') }}")
                    .then(response => {
                            response.text().then(gps => {GPS.innerText = gps})
                        });
                    }, 1000);
            }
        </script>
    </head>
    <body>
        <div style="text-align: center;">
        <img id="screen" src="{{ url_for('video_feed') }}" width="60%" style="
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-touch-callout: none;
        -moz-user-select: none;
        touch-callout: none;
        user-select: none;
        ">
        <table border="0" cellpadding="0" cellspacing="0" align="center">
            <tbody>
                <tr>
                    <td style="height:60px; text-align:center; width:60px">&nbsp;</td>
                    <td style="background-color:#66ffff; height:60px; text-align:center; width:60px"><span style="font-size:36px">&uarr;</span></td>
                    <td style="height:60px; text-align:center; width:60px">&nbsp;</td>
                    <td style="height:60px; text-align:left; width:360px"><p id="x_deg">x</p></td>
                </tr>
                <tr>
                    <td style="background-color:#66ffff; height:60px; text-align:center; width:60px"><span style="font-size:36px">&larr;</span></td>
                    <td style="height:60px; text-align:center; width:60px">&nbsp;</td>
                    <td style="background-color:#66ffff; height:60px; text-align:center; width:60px"><span style="font-size:36px">&rarr;</span></td>
                    <td style="height:60px; text-align:left; width:360px"><p id="y_deg">y</p></td>
                    <td style="background-color:#ff0000; height:60px; text-align:center; " id="jettison"><span style="font-size:36px; color:#ffff00">パラシュート分離</span></td>
                </tr>
                <tr>
                    <td style="height:60px; text-align:center; width:60px">&nbsp;</td>
                    <td style="background-color:#66ffff; height:60px; text-align:center; width:60px"><span style="font-size:36px">&darr;</span></td>
                    <td style="height:60px; text-align:center; width:60px">&nbsp;</td>
                    <td style="height:60px; text-align:left; width:360px"><p id="gps">gps</p></td>
                </tr>
            </tbody>
        </table>
        </div>
        <div style="text-align: center;">
            <a href="{{ url_for('shutdown') }}">シャットダウン</a>
        </div>
    </body>
</html>